<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìˆ˜ê±´ ìºë¹„ë„· í¼ì¦</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- jQuery + jQuery UI + Touch Punch -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

  <style>
    body { background: #f8f9fa; padding:20px; text-align:center; }
    .dropzone {
      width: 60px; height:60px;
      border:2px dashed #bbb; border-radius:5px;
      background:white; margin:0 5px; position:relative;
    }
    .towel {
      width:56px; height:56px;
      border-radius:4px;
      position:absolute; top:2px; left:2px;
      z-index:1000; cursor:grab;
    }
    .rack, .cabinets {
      display:flex; justify-content:center; margin-bottom:20px;
    }
    .cabinets .dropzone { height:120px; }
    #controls { margin-bottom:10px; }
    #result { margin-top:10px; font-weight:600; }
  </style>
</head>
<body>

  <h4>ğŸ” ìˆ˜ê±´ ìºë¹„ë„· í¼ì¦</h4>

  <!-- ì§„ì—´ëŒ€ (7ì¹¸) -->
  <div class="rack">
    <div class="dropzone" data-pos="0"></div>
    <div class="dropzone" data-pos="1"></div>
    <div class="dropzone" data-pos="2"></div>
    <div class="dropzone" data-pos="3"></div>
    <div class="dropzone" data-pos="4"></div>
    <div class="dropzone" data-pos="5"></div>
    <div class="dropzone" data-pos="6"></div>
  </div>

  <!-- ìºë¹„ë„· (4ì¹¸) -->
  <div class="cabinets">
    <div class="dropzone cabinet" data-pos="7"></div>
    <div class="dropzone cabinet" data-pos="8"></div>
    <div class="dropzone cabinet" data-pos="9"></div>
    <div class="dropzone cabinet" data-pos="10"></div>
  </div>

  <div id="controls">
    <button id="resetBtn" class="btn btn-secondary">ğŸ”„ ì´ˆê¸°í™”</button>
  </div>
  <div id="result"></div>

<script>
$(function(){
  const colors = ['red','orange','yellow','green','blue','navy','purple'];
  const solution = ['green','blue','red','yellow']; // ì˜ˆì‹œ ì •ë‹µ

  // 1) ì´ˆê¸°í™”
  function init(){
    $('.dropzone').empty();
    $('#result').empty();
    colors.forEach((c,i)=>{
      const $dz = $(`.dropzone[data-pos=${i}]`);
      const $tv = $('<div>').addClass('towel').css('background',c).attr('data-color',c);
      $dz.append($tv);
    });
    bindDrag();
  }

  // 2) ë“œë˜ê·¸ ë°”ì¸ë”©
  function bindDrag(){
    $('.towel').draggable({
      helper:'clone',
      appendTo:'body',
      revert:'invalid',
      cursorAt:{ top:28, left:28 },
      start(e,ui){ ui.helper.css('z-index',9999); }
    });
  }

  // 3) ë“œë¡­ ì²˜ë¦¬
  $('.dropzone').droppable({
    accept:'.towel',
    hoverClass:'border-primary',
    drop(e,ui){
      const $helper = ui.helper;      // clone helper
      const $orig   = ui.draggable;   // ì‹¤ì œ ìˆ˜ê±´
      const srcPos  = +$orig.parent().data('pos');
      const $srcDZ  = $orig.parent();
      const $tgtDZ  = $(this);
      const tgtPos  = +$tgtDZ.data('pos');
      if(srcPos===tgtPos){
        $helper.remove(); // ê·¸ëŒ€ë¡œ ë²„ë¦¬ê³  ë¦¬ë²„íŠ¸ ì—†ì´
        return;
      }
      // 3-1) helper ì œê±°
      $helper.remove();

      // 3-2) swap ëŒ€ìƒ í™•ì¸
      const $exist = $tgtDZ.find('.towel');
      // 3-3) ì›ë³¸ ìˆ˜ê±´ ë–¼ì–´ë‚´ê¸°
      $orig.detach();

      // 3-4) êµí™˜ ëŒ€ìƒì´ ìˆìœ¼ë©´ srcDZë¡œ ì´ë™
      if($exist.length){
        $exist.detach().appendTo($srcDZ);
        resetStyle($exist);
      }

      // 3-5) ì›ë³¸ ìˆ˜ê±´ tgtDZë¡œ ì´ë™
      $orig.appendTo($tgtDZ);
      positionInZone($orig);

      bindDrag();  // ì´ë™ëœ ê²ƒ ë‹¤ì‹œ ë“œë˜ê·¸ ê°€ëŠ¥
      updateResult();
    }
  });

  // 4) ìŠ¤íƒ€ì¼ í—¬í¼
  function positionInZone($t){
    $t.css({ position:'absolute', top:'2px', left:'2px' });
  }
  function resetStyle($t){
    $t.css({ position:'absolute', top:'2px', left:'2px' });
  }

  // 5) ê²°ê³¼ ì—…ë°ì´íŠ¸
  function updateResult(){
    const filled = $('.cabinet .towel').length;
    if(filled<4){
      $('#result').empty(); return;
    }
    let cm=0, pm=0;
    $('.cabinet').each((i,el)=>{
      const c = $(el).find('.towel').data('color');
      if(solution.includes(c)) cm++;
      if(solution[i]===c) pm++;
    });
    $('#result').text(`ìƒ‰ìƒ ì¼ì¹˜: ${cm}ê°œ, ìƒ‰ìƒ+ìœ„ì¹˜ ì¼ì¹˜: ${pm}ê°œ`);
  }

  // 6) ì´ˆê¸°í™”
  $('#resetBtn').click(init);

  init();
});
</script>
</body>
</html>
